---
import { X } from "lucide-astro";
---

<div
  id="lightbox"
  class="fixed inset-0 z-[60] bg-black/95 backdrop-blur-sm hidden items-center justify-center p-4 animate-fadeIn"
>
  <button
    id="lightbox-close"
    class="absolute top-4 right-4 text-white hover:text-lime-400 transition-colors"
  >
    <X size={40} />
  </button>
  <img
    id="lightbox-img"
    src=""
    alt="Full size"
    class="max-h-[90vh] max-w-full rounded-lg shadow-2xl border border-zinc-800"
  />
</div>

<script>
  function initLightbox() {
    const lightbox = document.getElementById("lightbox");
    const lightboxImg = document.getElementById("lightbox-img");
    const closeBtn = document.getElementById("lightbox-close");
    const triggers = document.querySelectorAll(".lightbox-trigger");

    if (!lightbox || !lightboxImg || !closeBtn) return;

    function openLightbox(src) {
      lightboxImg.src = src;
      lightbox.classList.remove("hidden");
      lightbox.classList.add("flex");
    }

    function closeLightbox() {
      lightbox.classList.add("hidden");
      lightbox.classList.remove("flex");
      lightboxImg.src = "";
    }

    triggers.forEach((trigger) => {
      trigger.addEventListener("click", (e) => {
        const src =
          trigger.getAttribute("data-src") || trigger.querySelector("img").src;
        openLightbox(src);
      });
    });

    closeBtn.addEventListener("click", closeLightbox);

    lightbox.addEventListener("click", (e) => {
      if (e.target === lightbox) {
        closeLightbox();
      }
    });
  }

  // Setup on page load and astro page transitions
  initLightbox();
  document.addEventListener("astro:page-load", initLightbox);
</script>
